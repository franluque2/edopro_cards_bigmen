--Takahashi's Legacy
--Skill Template
Duel.LoadScript("big_aux.lua")


local s,id=GetID()
function s.initial_effect(c)
	--Activate Skill
	aux.AddSkillProcedure(c,2,false,nil,nil)
	local e1=Effect.CreateEffect(c)
	e1:SetProperty(EFFECT_FLAG_UNCOPYABLE+EFFECT_FLAG_CANNOT_DISABLE)
	e1:SetType(EFFECT_TYPE_FIELD+EFFECT_TYPE_CONTINUOUS)
	e1:SetCode(EVENT_STARTUP)
	e1:SetCountLimit(1)
	e1:SetRange(0x5f)
	e1:SetLabel(0)
	e1:SetOperation(s.op)
	c:RegisterEffect(e1)
	aux.AddSkillProcedure(c,2,false,s.flipcon2,s.flipop2)
end
function s.op(e,tp,eg,ep,ev,re,r,rp)
	if e:GetLabel()==0 then
		local e1=Effect.CreateEffect(e:GetHandler())
		e1:SetType(EFFECT_TYPE_FIELD+EFFECT_TYPE_CONTINUOUS)
		e1:SetCode(EVENT_PREDRAW)
		e1:SetCondition(s.flipcon)
		e1:SetOperation(s.flipop)
		Duel.RegisterEffect(e1,tp)

		local e2=Effect.CreateEffect(e:GetHandler())
		e2:SetType(EFFECT_TYPE_FIELD+EFFECT_TYPE_CONTINUOUS)
		e2:SetCode(EVENT_PREDRAW)
		e2:SetCondition(s.changecon)
		e2:SetOperation(s.changeop)
		e2:SetCountLimit(1)
		Duel.RegisterEffect(e2,tp)

	end
	e:SetLabel(1)
end

local decks={{},{}}
for i = 0, 1 do
    decks[i] = {}

    for j = 0, 21 do
        decks[i][j] = {}
    end
end


-- monster, extra monster, backrow
decks[0][0] = { {54652250,54652250,54652250,31560081,31560081,31560081,26202165,26202165,26202165,13945283,13945283,13945283,15150365,15150365,78010363,78010363,78010363,23771716,23771716,23771716,97590747,97590747,97590747,70781052}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {4031928,53129443,19613556,19613556,19613556,83764719,55144522,12580477,72302403,72302403,79759861,79759861,79759861,44095762,44095762,44095762} }
decks[1][0] = { {54652250,54652250,54652250,31560081,31560081,31560081,26202165,26202165,26202165,13945283,13945283,13945283,15150365,15150365,78010363,78010363,78010363,23771716,23771716,23771716,97590747,97590747,97590747,70781052}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {4031928,53129443,19613556,19613556,19613556,83764719,55144522,12580477,72302403,72302403,79759861,79759861,79759861,44095762,44095762,44095762} }

decks[0][1] = { {15025844,15025844,15025844,46821314,46821314,46821314,13039848,13039848,13039848,7902349,8124921,44519536,70903634,33396948,54652250,54652250,54652250,511002631,511003012}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {4031928,12580477,18144506,18144506,53129443,55144522,70368879,72302403,79571449,79571449,79571449,30606547,30606547,45986603,70828912,44095762,62279055,83968380,83968380,83968380,97077563} }
decks[1][1] = { {15025844,15025844,15025844,46821314,46821314,46821314,13039848,13039848,13039848,7902349,8124921,44519536,70903634,33396948,54652250,54652250,54652250,511002631,511003012}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {4031928,12580477,18144506,18144506,53129443,55144522,70368879,72302403,79571449,79571449,79571449,30606547,30606547,45986603,70828912,44095762,62279055,83968380,83968380,83968380,97077563} }

decks[0][2] = { {72989439,82301904,77585513,73752131,73752131,70797118,70797118,88240808,88240808,71413901,7572887,7572887,78010363,78010363,26202165,3078576,31560081,31560081,8131171}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {4031928,12580477,17375316,18144506,19613556,42829885,44763025,53129443,55144522,71044499,71044499,74191942,79571449,83764719,97169186,5318639,45986603,70828912,44095762,83555666,61740673,97077563} }
decks[1][2] = { {72989439,82301904,77585513,73752131,73752131,70797118,70797118,88240808,88240808,71413901,7572887,7572887,78010363,78010363,26202165,3078576,31560081,31560081,8131171}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {4031928,12580477,17375316,18144506,19613556,42829885,44763025,53129443,55144522,71044499,71044499,74191942,79571449,83764719,97169186,5318639,45986603,70828912,44095762,83555666,61740673,97077563} }

decks[0][3] = { {72989439,18036057,70074904,2134346,33184167,71413901,7572887,83011277,4335645,34853266,26202165,23205979,31560081,31560081,8131171}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {19613556,31036355,44763025,46411259,46411259,46411259,55144522,69162969,71044499,71044499,72302403,79571449,5318639,14087893,73915051,73915051,73915051,45986603,70828912,29401950,44095762,53582587,60082869,83555666,97077563} }
decks[1][3] = { {72989439,18036057,70074904,2134346,33184167,71413901,7572887,83011277,4335645,34853266,26202165,23205979,31560081,31560081,8131171}, {87751584,13756293,86099788,86805855,86805855,49868263,90140980,80071763,80071763,85684223,85684223,17881964,58528964,63519819,63519819,63519819} , {19613556,31036355,44763025,46411259,46411259,46411259,55144522,69162969,71044499,71044499,72302403,79571449,5318639,14087893,73915051,73915051,73915051,45986603,70828912,29401950,44095762,53582587,60082869,83555666,97077563} }

decks[0][4] = { {4929256,9596126,9596126,51945556,70095154,70095154,2134346,2134346,71413901,7572887,83011277,83011277,34853266,74131780,26202165,23205979,23205979,47507260,69015963,31560081,31560081}, {1546123,27134689,74157028,74157028,87751584,13756293,86099788,86805855,13722870,49868263,66235877,80071763,85684223,17881964,63519819} , {17375316,19613556,31036355,31036355,32807846,71044499,71044499,79571449,85602018,97169186,5318639,14087893,73915051,98045062,98045062,45986603,45986603,44095762,53582587} }
decks[1][4] = { {4929256,9596126,9596126,51945556,70095154,70095154,2134346,2134346,71413901,7572887,83011277,83011277,34853266,74131780,26202165,23205979,23205979,47507260,69015963,31560081,31560081}, {1546123,27134689,74157028,74157028,87751584,13756293,86099788,86805855,13722870,49868263,66235877,80071763,85684223,17881964,63519819} , {17375316,19613556,31036355,31036355,32807846,71044499,71044499,79571449,85602018,97169186,5318639,14087893,73915051,98045062,98045062,45986603,45986603,44095762,53582587} }

decks[0][5] = { {47297616,47297616,73125233,73125233,73125233,70095154,71413901,84290642,26202165,93187568,31305911,23205979,12538374,24508238,9411399,9411399,9411399,511003116,511003116,40044918}, {1546123,27134689,74157028,74157028,87751584,13756293,86099788,86805855,13722870,49868263,66235877,80071763,85684223,17881964,63519819} , {19613556,32807846,32807846,45809008,45809008,45809008,67169062,68005187,81439173,87910978,5318639,73915051,98045062,70828912,44095762,53582587,57728570,63356631,63356631,97077563,19613556,32807846,32807846,45809008,45809008,45809008} }
decks[1][5] = { {47297616,47297616,73125233,73125233,73125233,70095154,71413901,84290642,26202165,93187568,31305911,23205979,12538374,24508238,9411399,9411399,9411399,511003116,511003116,40044918}, {1546123,27134689,74157028,74157028,87751584,13756293,86099788,86805855,13722870,49868263,66235877,80071763,85684223,17881964,63519819} , {19613556,32807846,32807846,45809008,45809008,45809008,67169062,68005187,81439173,87910978,5318639,73915051,98045062,70828912,44095762,53582587,57728570,63356631,63356631,97077563,19613556,32807846,32807846,45809008,45809008,45809008} }

decks[0][6] = { {40737112,47297616,47297616,40921744,65192027,65192027,65192027,14536035,14536035,82213171,26202165,23205979,24508238,9411399,9411399,9411399,511003116,511003116,40044918}, {1546123,27134689,74157028,74157028,87751584,13756293,86099788,86805855,13722870,49868263,66235877,80071763,85684223,17881964,63519819} , {1475311,1475311,1475311,19613556,23557835,32807846,32807846,45809008,45809008,45809008,75500286,83764718,87910978,98045062,9622164,70828912,15800838,27174286,53582587,57728570,64697231} }
decks[1][6] = { {40737112,47297616,47297616,40921744,65192027,65192027,65192027,14536035,14536035,82213171,26202165,23205979,24508238,9411399,9411399,9411399,511003116,511003116,40044918}, {1546123,27134689,74157028,74157028,87751584,13756293,86099788,86805855,13722870,49868263,66235877,80071763,85684223,17881964,63519819} , {1475311,1475311,1475311,19613556,23557835,32807846,32807846,45809008,45809008,45809008,75500286,83764718,87910978,98045062,9622164,70828912,15800838,27174286,53582587,57728570,64697231} }

decks[0][7] = { {65192027,65192027,9748752,9411399,9411399,9411399,14536035,71413901,13093792,13093792,83011277,26202165,4906301,41613948,23205979,59575539,59575539,33420078}, {70902743,70902743,23693634,23693634,70780151,70780151,70780151,44508094,44508094,44508094,45379225,73580471,7391448,7391448,43385557} , {1475311,1475311,1475311,19613556,32807846,32807846,45809008,45809008,45809008,83764719,87910978,5318639,67723438,57728570,63356631,63356631,64697231,93016201,93016201,41420027,41420027,41420027} }
decks[1][7] = { {65192027,65192027,9748752,9411399,9411399,9411399,14536035,71413901,13093792,13093792,83011277,26202165,4906301,41613948,23205979,59575539,59575539,33420078}, {70902743,70902743,23693634,23693634,70780151,70780151,70780151,44508094,44508094,44508094,45379225,73580471,7391448,7391448,43385557} , {1475311,1475311,1475311,19613556,32807846,32807846,45809008,45809008,45809008,83764719,87910978,5318639,67723438,57728570,63356631,63356631,64697231,93016201,93016201,41420027,41420027,41420027} }

decks[0][8] = { {99177923,99177923,99177923,14536035,14536035,56209279,56209279,56209279,49080532,49080532,49080532,85475641,86197239,86197239}, {79229522,27315304,95453143,72896720,23693634,44508094,44508094,7391448,97204936,50321796,43385557,76891401,86137485,26593852,29071332} , {2295440,19613556,32807846,42703248,81439173,5318639,14087893,14087893,66957584,66957584,66957584,14550855,14550855,14550855,29401950,29401950,53582587,60082869,60082869,64697231,94192409,97077563,9059700,9059700,9059700,41420027} }
decks[1][8] = { {99177923,99177923,99177923,14536035,14536035,56209279,56209279,56209279,49080532,49080532,49080532,85475641,86197239,86197239}, {79229522,27315304,95453143,72896720,23693634,44508094,44508094,7391448,97204936,50321796,43385557,76891401,86137485,26593852,29071332} , {2295440,19613556,32807846,42703248,81439173,5318639,14087893,14087893,66957584,66957584,66957584,14550855,14550855,14550855,29401950,29401950,53582587,60082869,60082869,64697231,94192409,97077563,9059700,9059700,9059700,41420027} }

decks[0][9] = { {11819616,47297616,9748752,9748752,20932152,20932152,5220687,5220687,14943837,14943837,26202165,48686504,48686504,85087012,15341821,15341821,16226786,33508719,21502796,21502796,21502796}, {70902743,44508094,44508094,44508094,18013090,73580471,42810973,25862681,46195773,19974580,19974580,3429238,3429238,50321796,26593852} , {19613556,67169062,67169062,67169062,81439173,87910978,5318639,14087893,14087893,29401950,29401950,44095762,53582587,58120309,60082869,70342110,70342110,97077563,41420027} }
decks[1][9] = { {11819616,47297616,9748752,9748752,20932152,20932152,5220687,5220687,14943837,14943837,26202165,48686504,48686504,85087012,15341821,15341821,16226786,33508719,21502796,21502796,21502796}, {70902743,44508094,44508094,44508094,18013090,73580471,42810973,25862681,46195773,19974580,19974580,3429238,3429238,50321796,26593852} , {19613556,67169062,67169062,67169062,81439173,87910978,5318639,14087893,14087893,29401950,29401950,44095762,53582587,58120309,60082869,70342110,70342110,97077563,41420027} }

decks[0][10] = { {37265642,37265642,37265642,51934376,51934376,51934376,11012887,11012887,11012887,85138716,85138716,10802915,10802915,26202165,80344569,23205979,23205979,16226786}, {44508094,84013237,74294676,74294676,42752141,42752141,28150174,25341652,12014404,81330115,69610924,95992081,95992081,52558805,78156759} , {19613556,53129443,83764719,5318639,5318639,14087893,27243130,27243130,27243130,29401950,29401950,53582587,53582587,58120309,70342110,70342110,30241314,30241314,50078509,50078509,41420027,84749824} }
decks[1][10] = { {37265642,37265642,37265642,51934376,51934376,51934376,11012887,11012887,11012887,85138716,85138716,10802915,10802915,26202165,80344569,23205979,23205979,16226786}, {44508094,84013237,74294676,74294676,42752141,42752141,28150174,25341652,12014404,81330115,69610924,95992081,95992081,52558805,78156759} , {19613556,53129443,83764719,5318639,5318639,14087893,27243130,27243130,27243130,29401950,29401950,53582587,53582587,58120309,70342110,70342110,30241314,30241314,50078509,50078509,41420027,84749824} }

decks[0][11] = { {21615956,53804307,53804307,53804307,26400609,26400609,26400609,89399912,89399912,89399912,90411554,90411554,90411554,91020571,91020571,27415516,27415516,53797637,53797637,89185742,89185742,23434538,23434538,23434538,97268402,97268402}, {80321197,76774528,23693634,23874409,73580471,25958491,29071332,74371660,22110647,22110647,22110647,91949988,80117527,80117527,71594310} , {19613556,45725480,45725480,45725480,72892473,75500286,75500286,14087893,27770341,27770341,27770341,5851097,5851097,5851097} }
decks[1][11] = { {21615956,53804307,53804307,53804307,26400609,26400609,26400609,89399912,89399912,89399912,90411554,90411554,90411554,91020571,91020571,27415516,27415516,53797637,53797637,89185742,89185742,23434538,23434538,23434538,97268402,97268402}, {80321197,76774528,23693634,23874409,73580471,25958491,29071332,74371660,22110647,22110647,22110647,91949988,80117527,80117527,71594310} , {19613556,45725480,45725480,45725480,72892473,75500286,75500286,14087893,27770341,27770341,27770341,5851097,5851097,5851097} }

decks[0][12] = { {85103922,85103922,85103922,45803070,45803070,91812341,91812341,91812341,68535320,68535320,68535320,95929069,95929069,95929069}, {91949988,31386180,73964868,29669359,38250531,21501505,94380860,48739166,63746411,95169481,46772449,581014,21044178,12014404,93568288} , {37520316,54447022,54447022,70368879,70368879,70368879,98645731,98645731,98645731,5318639,5318639,5318639,12444060,12444060,12444060,29401950,29616929,29616929,53582587,78474168,78474168,94192409,34507039,34507039,34507039,84749824} }
decks[1][12] = { {85103922,85103922,85103922,45803070,45803070,91812341,91812341,91812341,68535320,68535320,68535320,95929069,95929069,95929069}, {91949988,31386180,73964868,29669359,38250531,21501505,94380860,48739166,63746411,95169481,46772449,581014,21044178,12014404,93568288} , {37520316,54447022,54447022,70368879,70368879,70368879,98645731,98645731,98645731,5318639,5318639,5318639,12444060,12444060,12444060,29401950,29616929,29616929,53582587,78474168,78474168,94192409,34507039,34507039,34507039,84749824} }

decks[0][13] = { {81992475,57143342,57143342,57143342,41386308,41386308,62957424,36553319,36553319,20758643,20758643,20758643,10802915,84764038,84764038,84764038,734741,97268402,97268402,97268402}, {601193,72167543,72167543,72167543,81330115,81330115,31320433,47805931,75367227,15914410,78156759,83531441,83531441,83531441,65305468} , {12580477,53129443,53129443,81439173,4178474,15800838,15800838,15800838,36006208,57728570,60743819,60743819,63356631,71587526,71587526,78474168,78474168,5851097,59305593,82732705} }
decks[1][13] = { {81992475,57143342,57143342,57143342,41386308,41386308,62957424,36553319,36553319,20758643,20758643,20758643,10802915,84764038,84764038,84764038,734741,97268402,97268402,97268402}, {601193,72167543,72167543,72167543,81330115,81330115,31320433,47805931,75367227,15914410,78156759,83531441,83531441,83531441,65305468} , {12580477,53129443,53129443,81439173,4178474,15800838,15800838,15800838,36006208,57728570,60743819,60743819,63356631,71587526,71587526,78474168,78474168,5851097,59305593,82732705} }

decks[0][14] = { {75195825,69512157,69512157,17330916,17330916,17330916,92746535,92746535,92746535,40318957,40318957,40318957,67696066,68819554,68819554,68819554,47075569,47075569,47075569,31292357,7563579,7563579,71578874,73130445,23434538,23434538,53724621,53724621,97268402,97268402}, {22638495,17412721,18239909,18239909,10443957,58069384,17016362,63746411,82633039,88722973,581014,21044178,359563,18326736,6511113} , {1845204,14733538,14733538,14733538,31222701,31222701,31222701,43898403,43898403,99590524} }
decks[1][14] = { {75195825,69512157,69512157,17330916,17330916,17330916,92746535,92746535,92746535,40318957,40318957,40318957,67696066,68819554,68819554,68819554,47075569,47075569,47075569,31292357,7563579,7563579,71578874,73130445,23434538,23434538,53724621,53724621,97268402,97268402}, {22638495,17412721,18239909,18239909,10443957,58069384,17016362,63746411,82633039,88722973,581014,21044178,359563,18326736,6511113} , {1845204,14733538,14733538,14733538,31222701,31222701,31222701,43898403,43898403,99590524} }

decks[0][15] = { {6353603,77150143,77150143,31755044,31755044,31755044,78872731,78872731,78872731,81275020,81275020,81275020,53932291,23434538,23434538,11317977,11317977}, {17412721,44508094,56832966,84013237,581014,581014,11510448,11510448,41375811,48905153,48905153,74393852,85115440,85115440,4423206} , {1845204,12580477,53129443,74335036,74335036,25789292,25789292,25789292,46060017,46060017,46060017,57103969,57103969,57103969,58120309,58120309,73881652,83326048,83326048,83326048,40605147,40605147,40605147} }
decks[1][15] = { {6353603,77150143,77150143,31755044,31755044,31755044,78872731,78872731,78872731,81275020,81275020,81275020,53932291,23434538,23434538,11317977,11317977}, {17412721,44508094,56832966,84013237,581014,581014,11510448,11510448,41375811,48905153,48905153,74393852,85115440,85115440,4423206} , {1845204,12580477,53129443,74335036,74335036,25789292,25789292,25789292,46060017,46060017,46060017,57103969,57103969,57103969,58120309,58120309,73881652,83326048,83326048,83326048,40605147,40605147,40605147} }

decks[0][16] = { {12097275,60461077,24073068,24073068,24073068,97688360,97688360,2460565,2460565,2460565,56410040,56410040,56410040,14558127,14558127,14558127,59438930,59438930,59438930,73642296,73642296,73642296,54088068,54088068,10158145,85008676,85008676}, {70681994,4423206,5043020,65330383,32617464,38342335,2857636,2857636,59934749,59934749,75452921,39064822,39064822,3679218,3679218} , {1845204,1845204,1845204,32807846,54447022,62376646,83764719,24224830,24224830,24224830,19578592,31423101,98827725} }
decks[1][16] = { {12097275,60461077,24073068,24073068,24073068,97688360,97688360,2460565,2460565,2460565,56410040,56410040,56410040,14558127,14558127,14558127,59438930,59438930,59438930,73642296,73642296,73642296,54088068,54088068,10158145,85008676,85008676}, {70681994,4423206,5043020,65330383,32617464,38342335,2857636,2857636,59934749,59934749,75452921,39064822,39064822,3679218,3679218} , {1845204,1845204,1845204,32807846,54447022,62376646,83764719,24224830,24224830,24224830,19578592,31423101,98827725} }

decks[0][17] = { {71197066,93920420,93920420,78661338,78661338,78661338,4055337,4055337,14536035,57835716,57835716,57835716,28985331,41386308,21441617,4334811,4334811,14558127,14558127,14558127,24508238,24508238,24508238}, {87116928,93854893,93854893,5821478,66403530,85289965,72529749,76145142,38342335,2857636,30741503,30741503,30741503,65741786,63288573} , {1475311,1475311,26845680,26845680,32807846,63166095,63166095,63166095,81439173,99550630,51227866,52340444,98338152,90351981,10045474,10045474,703897} }
decks[1][17] = { {71197066,93920420,93920420,78661338,78661338,78661338,4055337,4055337,14536035,57835716,57835716,57835716,28985331,41386308,21441617,4334811,4334811,14558127,14558127,14558127,24508238,24508238,24508238}, {87116928,93854893,93854893,5821478,66403530,85289965,72529749,76145142,38342335,2857636,30741503,30741503,30741503,65741786,63288573} , {1475311,1475311,26845680,26845680,32807846,63166095,63166095,63166095,81439173,99550630,51227866,52340444,98338152,90351981,10045474,10045474,703897} }

decks[0][18] = { {94689206,94689206,94689206,47606319,45041488,45041488,11302671,11302671,11302671,80839052,80839052,80839052,10286023,10286023,14558127,14558127,14558127,48519867,48519867,48519867,72291078,42143067,42143067,42143067,85914562,85914562,85914562,76218313}, {27548199,9464441,42566602,73079836,79606837,81846453,32530043,85289965,4280258,38342335,2857636,50588353,83152482,65741786,85243784} , {14532163,14532163,14532163,67169062,72957245,72957245,72957245,83764719,24224830,24224830,24299458,24299458} }
decks[1][18] = { {94689206,94689206,94689206,47606319,45041488,45041488,11302671,11302671,11302671,80839052,80839052,80839052,10286023,10286023,14558127,14558127,14558127,48519867,48519867,48519867,72291078,42143067,42143067,42143067,85914562,85914562,85914562,76218313}, {27548199,9464441,42566602,73079836,79606837,81846453,32530043,85289965,4280258,38342335,2857636,50588353,83152482,65741786,85243784} , {14532163,14532163,14532163,67169062,72957245,72957245,72957245,83764719,24224830,24224830,24299458,24299458} }

decks[0][19] = { {87052196,87052196,23431858,23431858,93490856,93490856,93490856,56495147,56495147,56495147,20001443,20001443,20001443,55273560,55273560,55273560,14558127,14558127,14558127,97268402,97268402,97268402,98159737,98159737}, {40139997,96633955,84815190,19048328,9464441,5041348,74586817,69248256,69248256,83755611,43202238,68431965,78917791,32519092,32519092} , {56465981,56465981,56465981,65124425,65124425,93850690,24299458,24299458,24299458,65681983,65681983,10045474,10045474,10045474,14821890,14821890} }
decks[1][19] = { {87052196,87052196,23431858,23431858,93490856,93490856,93490856,56495147,56495147,56495147,20001443,20001443,20001443,55273560,55273560,55273560,14558127,14558127,14558127,97268402,97268402,97268402,98159737,98159737}, {40139997,96633955,84815190,19048328,9464441,5041348,74586817,69248256,69248256,83755611,43202238,68431965,78917791,32519092,32519092} , {56465981,56465981,56465981,65124425,65124425,93850690,24299458,24299458,24299458,65681983,65681983,10045474,10045474,10045474,14821890,14821890} }

decks[0][20] = { {6637331,6637331,6637331,33854624,33854624,33854624,572850,572850,572850,73956664,73956664,73956664,25926710,25926710,25926710,99937011,99937011,99937011,62320425,63542003,63542003,63542003,37961969,37961969,37961969,74078255,74078255,74078255,17266660,17266660,17266660}, {28226490,84330567,69946549,11765832,92731385,54757758,90448279,27552504,45935145,55285840,90590303,21044178,8264361,27381364,72329844} , {1845204,73628505,60362066,6767771,6767771,77103950,77103950,77103950,74920585,74920585} }
decks[1][20] = { {6637331,6637331,6637331,33854624,33854624,33854624,572850,572850,572850,73956664,73956664,73956664,25926710,25926710,25926710,99937011,99937011,99937011,62320425,63542003,63542003,63542003,37961969,37961969,37961969,74078255,74078255,74078255,17266660,17266660,17266660}, {28226490,84330567,69946549,11765832,92731385,54757758,90448279,27552504,45935145,55285840,90590303,21044178,8264361,27381364,72329844} , {1845204,73628505,60362066,6767771,6767771,77103950,77103950,77103950,74920585,74920585} }

decks[0][21] = { {27204311,27204311,27204311,68304193,68304193,32909498,32909498,32909498,78534861,91800273,91800273,91800273,31149212,31149212,31149212,14558127,14558127,14558127}, {84815190,90448279,90448279,48626373,48626373,45627618,98452268,16691074,78144171,80117527,73542331,73542331,8728498,23656668,23689428} , {34447918,34447918,34447918,35261759,35261759,73628505,84211599,84211599,84211599,27243130,27243130,27243130,69540484,69540484,69540484,71832012,71832012,71832012,33925864,24207889,24207889,24207889} }
decks[1][21] = { {27204311,27204311,27204311,68304193,68304193,32909498,32909498,32909498,78534861,91800273,91800273,91800273,31149212,31149212,31149212,14558127,14558127,14558127}, {84815190,90448279,90448279,48626373,48626373,45627618,98452268,16691074,78144171,80117527,73542331,73542331,8728498,23656668,23689428} , {34447918,34447918,34447918,35261759,35261759,73628505,84211599,84211599,84211599,27243130,27243130,27243130,69540484,69540484,69540484,71832012,71832012,71832012,33925864,24207889,24207889,24207889} }










function s.getyearval(tp)
	return math.ceil(Duel.GetTurnCount()/2) + Duel.GetFlagEffect(tp, id)
end


function s.changecon(e,tp,eg,ep,ev,re,r,rp)
    if Duel.GetTurnPlayer()~=tp then return false end
    return Duel.GetTurnCount()>2 and (s.getyearval(tp)<=#decks[0])
end
function s.changeop(e,tp,eg,ep,ev,re,r,rp)
	Duel.Hint(HINT_CARD,tp,id)


	s.updateyearval(tp)
	s.flipdownbackrow(tp)
	s.refillextra(tp)
	s.shufflebackpends(tp)
	s.changemononfield(tp)
	s.changebackrowonfield(tp)
	s.changeextra(tp)
	s.changeallelse(tp)

	if s.getyearval(tp)==14 then
		local e6=Effect.CreateEffect(e:GetHandler())
		e6:SetType(EFFECT_TYPE_FIELD)
		e6:SetCode(EFFECT_BECOME_LINKED_ZONE)
		e6:SetRange(LOCATION_FZONE)
		e6:SetValue(s.value)
		e6:SetReset(RESET_PHASE+PHASE_END)
		Duel.RegisterEffect(e6,tp)
	end


end

function s.value(e)
	return 0x1f<<16*e:GetHandlerPlayer()
end

function s.updateyearval(tp)
	if Duel.IsExistingMatchingCard(s.nostalgiamonfilter, tp, LOCATION_ONFIELD, 0, 1, nil) and s.getyearval(tp)<(#decks[0]-2) then
		Duel.RegisterFlagEffect(tp, id, 0, 0, 0)
	end
end

function s.flipdownbackrow(tp)
	local g=Duel.GetMatchingGroup(s.turnspelltrapfdfilter, tp, LOCATION_SZONE, 0, nil)

	if g and #g>0 then
		for tc in g:Iter() do
			if tc:IsType(TYPE_PENDULUM) then
				Duel.SendtoHand(tc, tp, REASON_RULE)
			else 
				Duel.ChangePosition(tc,POS_FACEDOWN)
			end
		end
	end
end

function s.refillextra(tp)
	local g=Duel.GetMatchingGroup(s.replaceextragravefilter, tp, LOCATION_GRAVE+LOCATION_REMOVED, 0, nil)

	if g and #g>0 then
		Duel.SendtoDeck(g, tp, SEQ_DECKTOP, REASON_RULE)
	end
end

function s.shufflebackpends(tp)
	local g=Duel.GetMatchingGroup(s.shufflependreplacefilter, tp, LOCATION_EXTRA, 0, nil)

	if g and #g>0 then
		Duel.SendtoDeck(g, tp, SEQ_DECKSHUFFLE, REASON_RULE)
	end
end

function s.changemononfield(tp)
	local g=Duel.GetMatchingGroup(s.replacemonfilter, tp, LOCATION_ONFIELD, 0, nil)

	if g and #g>0 then
		for tc in g:Iter() do
			if tc:IsAbleToExtraAsCost() then
				if #decks[tp][s.getyearval(tp)][2]==0 then return end
				local num=Duel.GetRandomNumber(1, #decks[tp][s.getyearval(tp)][2])
				Card.Recreate(tc, decks[tp][s.getyearval(tp)][2][num], nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,true)
				table.remove(decks[tp][s.getyearval(tp)][2], num)
			else
				if #decks[tp][s.getyearval(tp)][1]==0 then return end
				local num=Duel.GetRandomNumber(1, #decks[tp][s.getyearval(tp)][1])
				Card.Recreate(tc, decks[tp][s.getyearval(tp)][1][num], nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,true)
				table.remove(decks[tp][s.getyearval(tp)][1], num)
			end
		end
	end
end

function s.changebackrowonfield(tp)
	local g=Duel.GetMatchingGroup(s.replacespefilter, tp, LOCATION_ONFIELD, 0, nil)

	if g and #g>0 then
		for tc in g:Iter() do
			if #decks[tp][s.getyearval(tp)][3]==0 then return end
			local num=Duel.GetRandomNumber(1, #decks[tp][s.getyearval(tp)][3])
			Card.Recreate(tc, decks[tp][s.getyearval(tp)][3][num],nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,true)
			table.remove(decks[tp][s.getyearval(tp)][3], num)
		end
	end
end

function s.changeextra(tp)
	local g=Duel.GetMatchingGroup(s.replacemonfilter, tp, LOCATION_EXTRA, 0, nil)


	if g and #g>0 then
		for tc in g:Iter() do
			if #decks[tp][s.getyearval(tp)][2]==0 then return end
			local num=Duel.GetRandomNumber(1, #decks[tp][s.getyearval(tp)][2])
			Card.Recreate(tc, decks[tp][s.getyearval(tp)][2][num],nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,true)
			table.remove(decks[tp][s.getyearval(tp)][2], num)
		end
	end
	Duel.ShuffleExtra(tp)
end

function s.changeallelse(tp)
	local g=Duel.GetMatchingGroup(s.replacecardfilter, tp, LOCATION_HAND|LOCATION_DECK|LOCATION_GRAVE|LOCATION_REMOVED|LOCATION_OVERLAY, 0, nil)

	if g and #g>0 then
		for tc in g:Iter() do
			local cardtyp=-1
			if #decks[tp][s.getyearval(tp)][1]==0 then
				if #decks[tp][s.getyearval(tp)][3]==0 then return end
				cardtyp=3
			end

			if #decks[tp][s.getyearval(tp)][3]==0 then
				cardtyp=1
			end

			if cardtyp==-1 then
				cardtyp=Duel.GetRandomNumber(1,2)
				if cardtyp==2 then cardtyp=3 end
			end

			local num=Duel.GetRandomNumber(1, #decks[tp][s.getyearval(tp)][cardtyp])
			Card.Recreate(tc, decks[tp][s.getyearval(tp)][cardtyp][num],nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,nil,true)
			table.remove(decks[tp][s.getyearval(tp)][cardtyp], num)
		end
	end
	Duel.ShuffleDeck(tp)
	Duel.ShuffleHand(tp)

	local cardsingrave=g:Filter(Card.IsLocation, nil, LOCATION_GRAVE)
	local cardsremoved=g:Filter(Card.IsLocation, nil, LOCATION_REMOVED)
	Duel.Remove(cardsingrave, POS_FACEDOWN, REASON_RULE)
	Duel.SendtoGrave(cardsingrave, REASON_RULE+REASON_RETURN)
	Duel.SendtoGrave(cardsremoved, REASON_RULE+REASON_RETURN)
	Duel.Remove(cardsremoved, POS_FACEUP, REASON_RULE)


end

local bosses={70781052,511002631,72989439,63519819,9596126,12538374,65192027,44508094,72896720,3429238,42752141,22110647,73964868,83531441,10443957,48905153,5043020,93854893,9464441,96633955,84330567,48626373}
local bossmonsters={}
bossmonsters[0]=Group.CreateGroup()
bossmonsters[1]=Group.CreateGroup()




function s.flipcon(e,tp,eg,ep,ev,re,r,rp)
	return Duel.GetCurrentChain()==0 and Duel.GetTurnCount()==1
end
function s.flipop(e,tp,eg,ep,ev,re,r,rp)
	Duel.Hint(HINT_SKILL_FLIP,tp,id|(1<<32))
	Duel.Hint(HINT_CARD,tp,id)

	--start of duel effects go here

	if #bossmonsters[0]==0 then
		for i, v in pairs(bosses) do
			local token1=Duel.CreateToken(0, v)
			bossmonsters[0]:AddCard(token1)
			local token2=Duel.CreateToken(1, v)
			bossmonsters[1]:AddCard(token2)
		end
	end
end

function s.bondsunitydiscardfilter(c)
    return c:IsCode(15845914) and c:IsDiscardable(REASON_COST)
end

function s.thousandragondiscardfilter(c)
    return c:IsCode(0010000) and c:IsDiscardable(REASON_COST)
end

function s.nostalgiamonfilter(c)
    return c:IsCode(15845914,0010000) and c:IsFaceup()
end

function s.replacecardfilter(c)
	return (c:GetOwner()==c:GetControler() and not c:IsType(TYPE_TOKEN)) and not ((c:GetFlagEffect(id)>0) or c:IsCode(15845914,0010000))
end

function s.replacemonfilter(c)
    return (c:IsMonster() and c:GetOwner()==c:GetControler() and not c:IsType(TYPE_TOKEN)) and not ((c:GetFlagEffect(id)>0) or c:IsCode(15845914,0010000))
end

function s.replacespefilter(c)
    return c:IsSpellTrap() and c:GetOwner()==c:GetControler()
end

function s.replaceextragravefilter(c)
    return c:IsMonster() and c:IsAbleToExtraAsCost()
end

function s.shufflependreplacefilter(c)
    return c:IsMonster() and c:IsLocation(LOCATION_EXTRA) and c:IsType(TYPE_PENDULUM) and c:IsFaceup() and c:IsAbleToDeck()
end

function s.turnspelltrapfdfilter(c)
	return s.replacespefilter(c) and c:IsFaceup()
end


--effects to activate during the main phase go here
function s.flipcon2(e,tp,eg,ep,ev,re,r,rp)
	if Duel.GetFlagEffect(tp,id+1)>0 and Duel.GetFlagEffect(tp,id+2)>0  then return end

	local b1=Duel.GetFlagEffect(tp,id+1)==0
			and Duel.IsExistingMatchingCard(s.bondsunitydiscardfilter,tp,LOCATION_HAND,0,1,nil)
						and Duel.GetLocationCount(tp, LOCATION_MZONE)>0

	local b2=Duel.GetFlagEffect(tp,id+2)==0
	and Duel.IsExistingMatchingCard(s.thousandragondiscardfilter,tp,LOCATION_HAND,0,1,nil)
				and Duel.GetLocationCount(tp, LOCATION_MZONE)>0


--return the b1 or b2 or .... in parenthesis at the end
	return aux.CanActivateSkill(tp) and (b1 or b2)
end
function s.flipop2(e,tp,eg,ep,ev,re,r,rp)
	--"pop" the skill card
	Duel.Hint(HINT_CARD,tp,id)
	--Boolean check for effect 1:

--copy the bxs from above

local b1=Duel.GetFlagEffect(tp,id+1)==0
	and Duel.IsExistingMatchingCard(s.bondsunitydiscardfilter,tp,LOCATION_HAND,0,1,nil)
			and Duel.GetLocationCount(tp, LOCATION_MZONE)>0

local b2=Duel.GetFlagEffect(tp,id+2)==0
	and Duel.IsExistingMatchingCard(s.thousandragondiscardfilter,tp,LOCATION_HAND,0,1,nil)
		and Duel.GetLocationCount(tp, LOCATION_MZONE)>0


--effect selector
	local op=Duel.SelectEffect(tp, {b1,aux.Stringid(id,1)},
								  {b2,aux.Stringid(id,0)})
	op=op-1 --SelectEffect returns indexes starting at 1, so we decrease the result by 1 to match your "if"s
	if op==0 then
		s.operation_for_res0(e,tp,eg,ep,ev,re,r,rp)
	elseif op==1 then
		s.operation_for_res1(e,tp,eg,ep,ev,re,r,rp)
	end
end


function s.addxyzmaterial(tp, tc)
	--ariseheart
	if tc:IsCode(48626373) then
		local fenrir=Duel.CreateToken(tp, 32909498)
		Duel.SendtoGrave(fenrir, REASON_RULE)
		fenrir:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,fenrir)

		local bigbang=Duel.CreateToken(tp, 33925864)
		Duel.SendtoGrave(bigbang, REASON_RULE)
		bigbang:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,bigbang)
	end
	--dolkka
	if tc:IsCode(42752141) then
		local sabersaurus1=Duel.CreateToken(tp, 37265642)
		Duel.SendtoGrave(sabersaurus1, REASON_RULE)
		sabersaurus1:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,sabersaurus1)

		local sabersaurus2=Duel.CreateToken(tp, 37265642)
		Duel.SendtoGrave(sabersaurus2, REASON_RULE)
		sabersaurus2:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,sabersaurus2)
	end
	--dracossack
	if tc:IsCode(22110647) then
		local tempest=Duel.CreateToken(tp, 89399912)
		Duel.SendtoGrave(tempest, REASON_RULE)
		tempest:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,tempest)

		local tidal=Duel.CreateToken(tp, 26400609)
		Duel.SendtoGrave(tidal, REASON_RULE)
		tidal:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,tidal)
	end
	--pleiades
	if tc:IsCode(73964868) then
		local scythe=Duel.CreateToken(tp, 20292186)
		Duel.SendtoGrave(scythe, REASON_RULE)
		scythe:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,scythe)

		local moraltach=Duel.CreateToken(tp, 85103922)
		Duel.SendtoGrave(moraltach, REASON_RULE)
		moraltach:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,moraltach)
	end
	--dante
	if tc:IsCode(83531441) then
		local cir=Duel.CreateToken(tp, 57143342)
		Duel.SendtoGrave(cir, REASON_RULE)
		cir:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,cir)

		local farfa=Duel.CreateToken(tp, 36553319)
		Duel.SendtoGrave(farfa, REASON_RULE)
		farfa:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,farfa)
	end
	--cdi
	if tc:IsCode(10443957) then
		local tricklown=Duel.CreateToken(tp, 67696066)
		Duel.SendtoGrave(tricklown, REASON_RULE)
		tricklown:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,tricklown)

		local dmgjugg=Duel.CreateToken(tp, 68819554)
		Duel.SendtoGrave(dmgjugg, REASON_RULE)
		dmgjugg:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,dmgjugg)
	end
	--drident
	if tc:IsCode(48905153) then
		local whiptail=Duel.CreateToken(tp, 31755044)
		Duel.SendtoGrave(whiptail, REASON_RULE)
		whiptail:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,whiptail)

		local ramram=Duel.CreateToken(tp, 04145852)
		Duel.SendtoGrave(ramram, REASON_RULE)
		ramram:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,ramram)
	end
	--dingirsu
	if tc:IsCode(93854893) then
		local cymbal=Duel.CreateToken(tp, 21441617)
		Duel.SendtoGrave(cymbal, REASON_RULE)
		cymbal:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,cymbal)

		local wwand=Duel.CreateToken(tp, 93920420)
		Duel.SendtoGrave(wwand, REASON_RULE)
		wwand:RegisterFlagEffect(id, 0, 0, 0)
		Duel.Overlay(tc,wwand)
	end
end


function s.operation_for_res0(e,tp,eg,ep,ev,re,r,rp)
	Duel.Hint(HINT_SELECTMSG, tp, HINTMSG_DISCARD)
	local disc=Duel.SelectMatchingCard(tp, s.bondsunitydiscardfilter, tp, LOCATION_HAND, 0, 1,1,false,nil)
	if Duel.SendtoGrave(disc, REASON_DISCARD) then
		local year=s.getyearval(tp)
		if year > #bosses then year=#bosses	end
		local diff=#bosses-year

		local g=Group.CreateGroup()
		g:AddCard(bossmonsters[tp]:TakeatPos(year))
		if diff>0 then
			if diff==1 then
				g:AddCard(bossmonsters[tp]:TakeatPos(year+1))
				
			elseif diff==2 then
				g:AddCard(bossmonsters[tp]:TakeatPos(year+1))
				g:AddCard(bossmonsters[tp]:TakeatPos(year+2))
			else
				g:AddCard(bossmonsters[tp]:TakeatPos(year+1))
				g:AddCard(bossmonsters[tp]:TakeatPos(year+2))
				g:AddCard(bossmonsters[tp]:TakeatPos(year+3))

			end
		end
		Duel.Hint(HINT_SELECTMSG, tp, HINTMSG_SPSUMMON)
		local tar=g:Select(tp, 1,1,false,nil)
		if tar then
			local token=Duel.CreateToken(tp, tar:GetFirst():GetOriginalCode())
			if token:IsType(TYPE_XYZ) then
				Duel.SpecialSummon(token, SUMMON_TYPE_XYZ, tp, tp, true, true, POS_FACEUP)
			elseif token:IsType(TYPE_SYNCHRO) then
				Duel.SpecialSummon(token, SUMMON_TYPE_SYNCHRO, tp, tp, true, true, POS_FACEUP)
			elseif token:IsType(TYPE_FUSION) then
				Duel.SpecialSummon(token, SUMMON_TYPE_FUSION, tp, tp, true, true, POS_FACEUP)
			elseif token:IsType(TYPE_LINK) then
				Duel.SpecialSummon(token, SUMMON_TYPE_LINK, tp, tp, true, true, POS_FACEUP)
			else
				Duel.SpecialSummon(token, SUMMON_TYPE_SPECIAL, tp, tp, true, true, POS_FACEUP)
			end

			if token:IsType(TYPE_XYZ) then
				s.addxyzmaterial(tp,token)
			end
			token:RegisterFlagEffect(id, 0, 0, 0)
		end
	end
	Duel.RegisterFlagEffect(tp,id+1,RESET_EVENT+RESETS_STANDARD+RESET_PHASE+PHASE_END,0,0)
end


function s.operation_for_res1(e,tp,eg,ep,ev,re,r,rp)

	Duel.Hint(HINT_SELECTMSG, tp, HINTMSG_DISCARD)
	local disc=Duel.SelectMatchingCard(tp, s.thousandragondiscardfilter, tp, LOCATION_HAND, 0, 1,1,false,nil)
	if Duel.SendtoGrave(disc, REASON_DISCARD) then
		local year=s.getyearval(tp)-1
		local g=Group.CreateGroup()
		g:AddCard(bossmonsters[tp]:TakeatPos(year))
		if year>0 then
			if year==1 then
				g:AddCard(bossmonsters[tp]:TakeatPos(year-1))
				
			elseif year==2 then
				g:AddCard(bossmonsters[tp]:TakeatPos(year-1))
				g:AddCard(bossmonsters[tp]:TakeatPos(year-2))
			else
				g:AddCard(bossmonsters[tp]:TakeatPos(year-1))
				g:AddCard(bossmonsters[tp]:TakeatPos(year-2))
				g:AddCard(bossmonsters[tp]:TakeatPos(year-3))

			end
		end
		Duel.Hint(HINT_SELECTMSG, tp, HINTMSG_SPSUMMON)
		local tar=g:Select(tp, 1,1,false,nil)
		if tar then
			local token=Duel.CreateToken(tp, tar:GetFirst():GetOriginalCode())
			Duel.SpecialSummon(token, SUMMON_TYPE_SPECIAL, tp, tp, true, true, POS_FACEUP)
			if token:IsType(TYPE_XYZ) then
				s.addxyzmaterial(tp,token)
			end
			token:RegisterFlagEffect(id, 0, 0, 0)

		end
	end
	Duel.RegisterFlagEffect(tp,id+2,RESET_EVENT+RESETS_STANDARD+RESET_PHASE+PHASE_END,0,0)
end
